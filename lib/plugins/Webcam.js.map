{"version":3,"sources":["../../src/plugins/Webcam.js"],"names":["Webcam","opts","params","_userMedia","userMedia","protocol","location","match","defaultOptions","enableFlash","defaultParams","swfURL","width","height","dest_width","dest_height","image_format","jpeg_quality","enable_flash","force_flash","flip_horiz","fps","upload_name","constraints","flashNotDetectedText","noInterfaceFoundText","unfreeze_snap","Object","assign","start","bind","init","stop","takeSnapshot","getImage","getSWFHTML","detectFlash","getUserMedia","getMediaDevices","mediaDevices","window","addEventListener","event","reset","navigator","mozGetUserMedia","webkitGetUserMedia","Promise","resolve","reject","call","userAgent","parseInt","RegExp","$1","URL","webkitURL","mozURL","msURL","undefined","audio","video","then","stream","catch","err","SHOCKWAVE_FLASH","SHOCKWAVE_FLASH_AX","FLASH_MIME_TYPE","win","nav","hasFlash","plugins","desc","description","mimeTypes","enabledPlugin","ActiveXObject","ax","ver","GetVariable","e","preview_active","unfreeze","getVideoTracks","tracks","getMovie","_releaseCamera","base_url","scpts","document","getElementsByTagName","idx","len","length","src","getAttribute","replace","flashvars","key","escape","html","movie","getElementById","_snap","console","log","videoStream","updateState","cameraReady","msStop","onended","onerror","pause","mozSrcObject","querySelector","canvas","type","msg","live","panel","_configure","createElement","videoWidth","videoHeight","getContext","drawImage","dataUrl","toDataURL","mimeType","file","name","data","Date","now","image","tagFile","source","id"],"mappings":"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","file":"Webcam.js","sourcesContent":["'use strict'\n\nimport dataURItoFile from '../utils/dataURItoFile'\n\n/**\n * Webcam Plugin\n */\nexport default class Webcam {\n  constructor (opts = {}, params = {}) {\n    this._userMedia\n    this.userMedia = true\n    this.protocol = location.protocol.match(/https/i) ? 'https' : 'http'\n\n    // set default options\n    const defaultOptions = {\n      enableFlash: true\n    }\n\n    const defaultParams = {\n      swfURL: 'webcam.swf',\n      width: 400,\n      height: 300,\n      dest_width: 800,         // size of captured image\n      dest_height: 600,        // these default to width/height\n      image_format: 'jpeg',  // image format (may be jpeg or png)\n      jpeg_quality: 90,      // jpeg image quality from 0 (worst) to 100 (best)\n      enable_flash: true,    // enable flash fallback,\n      force_flash: false,    // force flash mode,\n      flip_horiz: false,     // flip image horiz (mirror mode)\n      fps: 30,               // camera frames per second\n      upload_name: 'webcam', // name of file in upload post data\n      constraints: null,     // custom user media constraints,\n      flashNotDetectedText: 'ERROR: No Adobe Flash Player detected.  Webcam.js relies on Flash for browsers that do not support getUserMedia (like yours).',\n      noInterfaceFoundText: 'No supported webcam interface found.',\n      unfreeze_snap: true    // Whether to unfreeze the camera after snap (defaults to true)\n    }\n\n    this.params = Object.assign({}, defaultParams, params)\n\n    // merge default options with the ones set by user\n    this.opts = Object.assign({}, defaultOptions, opts)\n\n    // Camera controls\n    this.start = this.start.bind(this)\n    this.init = this.init.bind(this)\n    this.stop = this.stop.bind(this)\n    // this.startRecording = this.startRecording.bind(this)\n    // this.stopRecording = this.stopRecording.bind(this)\n    this.takeSnapshot = this.takeSnapshot.bind(this)\n    this.getImage = this.getImage.bind(this)\n    this.getSWFHTML = this.getSWFHTML.bind(this)\n    this.detectFlash = this.detectFlash.bind(this)\n    this.getUserMedia = this.getUserMedia.bind(this)\n    this.getMediaDevices = this.getMediaDevices.bind(this)\n  }\n\n  /**\n   * Checks for getUserMedia support\n   */\n  init () {\n    // initialize, check for getUserMedia support\n    this.mediaDevices = this.getMediaDevices()\n\n    this.userMedia = this.getUserMedia(this.mediaDevices)\n\n    // Make sure media stream is closed when navigating away from page\n    if (this.userMedia) {\n      window.addEventListener('beforeunload', (event) => {\n        this.reset()\n      })\n    }\n\n    return {\n      mediaDevices: this.mediaDevices,\n      userMedia: this.userMedia\n    }\n  }\n\n  // Setup getUserMedia, with polyfill for older browsers\n  // Adapted from: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n  getMediaDevices () {\n    return (navigator.mediaDevices && navigator.mediaDevices.getUserMedia)\n      ? navigator.mediaDevices : ((navigator.mozGetUserMedia || navigator.webkitGetUserMedia) ? {\n        getUserMedia: function (opts) {\n          return new Promise(function (resolve, reject) {\n            (navigator.mozGetUserMedia ||\n            navigator.webkitGetUserMedia).call(navigator, opts, resolve, reject)\n          })\n        }\n      } : null)\n  }\n\n  getUserMedia (mediaDevices) {\n    const userMedia = true\n    // Older versions of firefox (< 21) apparently claim support but user media does not actually work\n    if (navigator.userAgent.match(/Firefox\\D+(\\d+)/)) {\n      if (parseInt(RegExp.$1, 10) < 21) {\n        return null\n      }\n    }\n\n    window.URL = window.URL || window.webkitURL || window.mozURL || window.msURL\n    return userMedia && !!mediaDevices && !!window.URL\n  }\n\n  start () {\n    this.userMedia = this._userMedia === undefined ? this.userMedia : this._userMedia\n    return new Promise((resolve, reject) => {\n      if (this.userMedia) {\n        // ask user for access to their camera\n        this.mediaDevices.getUserMedia({\n          audio: false,\n          video: true\n        })\n        .then((stream) => {\n          this.stream = stream\n          return resolve(stream)\n        })\n        .catch((err) => {\n          return reject(err)\n        })\n      }\n    })\n  }\n\n  /**\n   * Detects if browser supports flash\n   * Code snippet borrowed from: https://github.com/swfobject/swfobject\n   *\n   * @return {bool} flash supported\n   */\n  detectFlash () {\n    const SHOCKWAVE_FLASH = 'Shockwave Flash'\n    const SHOCKWAVE_FLASH_AX = 'ShockwaveFlash.ShockwaveFlash'\n    const FLASH_MIME_TYPE = 'application/x-shockwave-flash'\n    const win = window\n    const nav = navigator\n    let hasFlash = false\n\n    if (typeof nav.plugins !== 'undefined' && typeof nav.plugins[SHOCKWAVE_FLASH] === 'object') {\n      var desc = nav.plugins[SHOCKWAVE_FLASH].description\n      if (desc && (typeof nav.mimeTypes !== 'undefined' && nav.mimeTypes[FLASH_MIME_TYPE] && nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin)) {\n        hasFlash = true\n      }\n    } else if (typeof win.ActiveXObject !== 'undefined') {\n      try {\n        var ax = new win.ActiveXObject(SHOCKWAVE_FLASH_AX)\n        if (ax) {\n          var ver = ax.GetVariable('$version')\n          if (ver) hasFlash = true\n        }\n      } catch (e) {}\n    }\n\n    return hasFlash\n  }\n\n  reset () {\n    // shutdown camera, reset to potentially attach again\n    if (this.preview_active) this.unfreeze()\n\n    if (this.userMedia) {\n      if (this.stream) {\n        if (this.stream.getVideoTracks) {\n          // get video track to call stop on it\n          var tracks = this.stream.getVideoTracks()\n          if (tracks && tracks[0] && tracks[0].stop) tracks[0].stop()\n        } else if (this.stream.stop) {\n          // deprecated, may be removed in future\n          this.stream.stop()\n        }\n      }\n      delete this.stream\n      delete this.video\n    }\n\n    if (this.userMedia !== true) {\n      // call for turn off camera in flash\n      this.getMovie()._releaseCamera()\n    }\n  }\n\n  getSWFHTML () {\n    // Return HTML for embedding flash based webcam capture movie\n    var swfURL = this.params.swfURL\n\n    // make sure we aren't running locally (flash doesn't work)\n    if (location.protocol.match(/file/)) {\n      return '<h3 style=\"color:red\">ERROR: the Webcam.js Flash fallback does not work from local disk.  Please run it from a web server.</h3>'\n    }\n\n    // make sure we have flash\n    if (!this.detectFlash()) {\n      return '<h3 style=\"color:red\">No flash</h3>'\n    }\n\n    // set default swfURL if not explicitly set\n    if (!swfURL) {\n      // find our script tag, and use that base URL\n      var base_url = ''\n      var scpts = document.getElementsByTagName('script')\n      for (var idx = 0, len = scpts.length; idx < len; idx++) {\n        var src = scpts[idx].getAttribute('src')\n        if (src && src.match(/\\/webcam(\\.min)?\\.js/)) {\n          base_url = src.replace(/\\/webcam(\\.min)?\\.js.*$/, '')\n          idx = len\n        }\n      }\n      if (base_url) swfURL = base_url + '/webcam.swf'\n      else swfURL = 'webcam.swf'\n    }\n\n    // // if this is the user's first visit, set flashvar so flash privacy settings panel is shown first\n    // if (window.localStorage && !localStorage.getItem('visited')) {\n    //   // this.params.new_user = 1\n    //   localStorage.setItem('visited', 1)\n    // }\n    // this.params.new_user = 1\n    // construct flashvars string\n    var flashvars = ''\n    for (var key in this.params) {\n      if (flashvars) flashvars += '&'\n      flashvars += key + '=' + escape(this.params[key])\n    }\n\n    // construct object/embed tag\n\n    return html`<object classid=\"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\" type=\"application/x-shockwave-flash\" codebase=\"${this.protocol}://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0\" width=\"${this.params.width}\" height=\"${this.params.height}\" id=\"webcam_movie_obj\" align=\"middle\"><param name=\"wmode\" value=\"opaque\" /><param name=\"allowScriptAccess\" value=\"always\" /><param name=\"allowFullScreen\" value=\"false\" /><param name=\"movie\" value=\"${swfURL}\" /><param name=\"loop\" value=\"false\" /><param name=\"menu\" value=\"false\" /><param name=\"quality\" value=\"best\" /><param name=\"bgcolor\" value=\"#ffffff\" /><param name=\"flashvars\" value=\"${flashvars}\"/><embed id=\"webcam_movie_embed\" src=\"${swfURL}\" wmode=\"opaque\" loop=\"false\" menu=\"false\" quality=\"best\" bgcolor=\"#ffffff\" width=\"${this.params.width}\" height=\"${this.params.height}\" name=\"webcam_movie_embed\" align=\"middle\" allowScriptAccess=\"always\" allowFullScreen=\"false\" type=\"application/x-shockwave-flash\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\" flashvars=\"${flashvars}\"></embed></object>`\n  }\n\n  getMovie () {\n    // get reference to movie object/embed in DOM\n    var movie = document.getElementById('webcam_movie_obj')\n    if (!movie || !movie._snap) movie = document.getElementById('webcam_movie_embed')\n    if (!movie) console.log('getMovie error')\n    return movie\n  }\n\n  /**\n   * Stops the webcam capture and video playback.\n   */\n  stop () {\n    let { video, videoStream } = this\n\n    this.updateState({\n      cameraReady: false\n    })\n\n    if (videoStream) {\n      if (videoStream.stop) {\n        videoStream.stop()\n      } else if (videoStream.msStop) {\n        videoStream.msStop()\n      }\n\n      videoStream.onended = null\n      videoStream = null\n    }\n\n    if (video) {\n      video.onerror = null\n      video.pause()\n\n      if (video.mozSrcObject) {\n        video.mozSrcObject = null\n      }\n\n      video.src = ''\n    }\n\n    this.video = document.querySelector('.UppyWebcam-video')\n    this.canvas = document.querySelector('.UppyWebcam-canvas')\n  }\n\n  flashNotify (type, msg) {\n    // receive notification from flash about event\n    switch (type) {\n      case 'flashLoadComplete':\n        // movie loaded successfully\n        break\n\n      case 'cameraLive':\n        // camera is live and ready to snap\n        this.live = true\n        break\n\n      case 'error':\n        // Flash error\n        console.log('There was a flash error', msg)\n        break\n\n      default:\n        // catch-all event, just in case\n        console.log('webcam flash_notify: ' + type + ': ' + msg)\n        break\n    }\n  }\n\n  configure (panel) {\n    // open flash configuration panel -- specify tab name:\n    // 'camera', 'privacy', 'default', 'localStorage', 'microphone', 'settingsManager'\n    if (!panel) panel = 'camera'\n    this.getMovie()._configure(panel)\n  }\n\n  /**\n   * Takes a snapshot and displays it in a canvas.\n   */\n  getImage (video, opts) {\n    var canvas = document.createElement('canvas')\n    canvas.width = video.videoWidth\n    canvas.height = video.videoHeight\n    canvas.getContext('2d').drawImage(video, 0, 0)\n\n    var dataUrl = canvas.toDataURL(opts.mimeType)\n\n    var file = dataURItoFile(dataUrl, {\n      name: opts.name\n    })\n\n    return {\n      dataUrl: dataUrl,\n      data: file,\n      type: opts.mimeType\n    }\n  }\n\n  takeSnapshot (video, canvas) {\n    const opts = {\n      name: `webcam-${Date.now()}.jpg`,\n      mimeType: 'image/jpeg'\n    }\n\n    const image = this.getImage(video, canvas, opts)\n\n    const tagFile = {\n      source: this.id,\n      name: opts.name,\n      data: image.data,\n      type: opts.type\n    }\n\n    return tagFile\n  }\n}\n"]}